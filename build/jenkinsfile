pipeline {
  agent {
    label 'agent1'
   }

  stages{
        stage("Clean Workspace") { 
            steps {
                cleanWs()
            }
        }

        stage("App Codeckeckout"){
            steps {
                git branch: "main", url:"https://github.com/prateekkumawat/jenkins-11-project-ci.git"
            }  
        }

        stage("build Image"){
            steps{
                sh 'docker build -t prateekkumawat/jenkinsimage:v1 .'
            }
        }

        stage("Image push"){
            environment {
                DOCKER_CREDS = credentials('docker-creds')
            }
            steps{
                sh "docker login -u $DOCKER_CREDS_USR -p $DOCKER_CREDS_PSW "
                sh "docker push prateekkumawat/jenkinsimage:v1 " 
            }
        }
    }
}